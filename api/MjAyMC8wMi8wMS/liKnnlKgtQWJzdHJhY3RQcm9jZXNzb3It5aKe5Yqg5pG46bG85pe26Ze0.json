{"title":"åˆ©ç”¨ AbstractProcessor å¢åŠ æ‘¸é±¼æ—¶é—´","date":"2020-02-01T11:44:52.000Z","date_formatted":{"ll":"Feb 1, 2020","L":"02/01/2020","MM-DD":"02-01"},"link":"2020/02/01/åˆ©ç”¨-AbstractProcessor-å¢åŠ æ‘¸é±¼æ—¶é—´","tags":["Java"],"updated":"2021-03-01T13:33:12.203Z","content":"<p>ç»ä¸æ‰‹å†™èƒ½é€šè¿‡ä»£ç ç”Ÿæˆçš„ä»£ç ï¼ï¼ï¼</p>\n<h1 id=\"èƒŒæ™¯\">èƒŒæ™¯<a title=\"#èƒŒæ™¯\" href=\"#èƒŒæ™¯\"></a></h1>\n<p>å†…éƒ¨ SOA æ¡†æ¶è¦æ±‚æ‰€æœ‰åº”ç”¨å¯¹å¤–æš´éœ²çš„æ¥å£è¦å®šä¹‰ä¸€ä»½ interface ï¼Œå¹¶ä¸”å®ç°å®ƒã€‚</p>\n<p>å¦‚ä¸‹ï¼Œæ¯æ–°å¢ä¸€ä¸ª HTTP æ¥å£éƒ½éœ€è¦åœ¨ TestSOAService ä¸­æ·»åŠ å‡½æ•°å®šä¹‰ï¼Œå¹¶åœ¨ TestSOAServiceImpl å®ç°ã€‚</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">TestSOAService</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\">HelloWorldResponseType <span class=\"title\">helloWorld</span><span class=\"params\">(HelloWorldRequestType request)</span> <span class=\"keyword\">throws</span> Exception</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Service</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TestSOAServiceImpl</span> <span class=\"keyword\">implements</span> <span class=\"title\">TestSOAService</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ServiceInvoker serviceInvoker;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> HelloWorldResponseType <span class=\"title\">helloWorld</span><span class=\"params\">(HelloWorldRequestType request)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> serviceInvoker.invoke(HelloWorldService.class, request);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h1 id=\"è§£å†³åŠæ³•\">è§£å†³åŠæ³•<a title=\"#è§£å†³åŠæ³•\" href=\"#è§£å†³åŠæ³•\"></a></h1>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Service</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DefaultServiceInvokerImpl</span> <span class=\"keyword\">implements</span> <span class=\"title\">ServiceInvoker</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> ApplicationContext context;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">DefaultServiceInvokerImpl</span><span class=\"params\">(ApplicationContext context)</span> </span>&#123; <span class=\"keyword\">this</span>.context = context; &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> &lt;Q, S, T&gt; <span class=\"function\">S <span class=\"title\">invoke</span><span class=\"params\">(Class&lt;T&gt; cls, Q req)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> context.getBean(cls).service(req);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>ç”±äºæ¯ä¸ªæ¥å£éƒ½æ˜¯ç»Ÿä¸€è°ƒç”¨è‡ªå®šä¹‰å®ç°çš„ ServiceInvoker.invoke æ–¹æ³•ï¼Œæ‰€ä»¥æ¯ä¸ªæ¥å£çš„å®šä¹‰å’Œå®ç°åªæœ‰åç§°ä¸åŒã€‚</p>\n<p>å› æ­¤è€ƒè™‘é€šè¿‡å®šä¹‰ä¸€ä¸ª AbstractProcessor çš„å­ç±»æ¥ç”Ÿæˆæ¥å£å®šä¹‰å’Œå®ç°æ–‡ä»¶ä»£ç ã€‚</p>\n<h2 id=\"è‡ªå®šä¹‰-annotation\">è‡ªå®šä¹‰ Annotation<a title=\"#è‡ªå®šä¹‰-annotation\" href=\"#è‡ªå®šä¹‰-annotation\"></a></h2>\n<p>è‡ªå®šä¹‰ä¸€ä¸ª Annotation ï¼Œæ·»åŠ åˆ°æ¯ä¸ªæ¥å£ Service ç±»ä¸Šã€‚</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Target(ElementType.TYPE)</span></span><br><span class=\"line\"><span class=\"meta\">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class=\"line\"><span class=\"meta\">@Service</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"meta\">@interface</span> WebService &#123;</span><br><span class=\"line\">    <span class=\"function\">String <span class=\"title\">name</span><span class=\"params\">()</span> <span class=\"keyword\">default</span> &quot;TestSOAService&quot;</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@WebService</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HelloWorldService</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> HelloWorldResponseType <span class=\"title\">service</span><span class=\"params\">(HelloWorldRequestType request)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        HelloWorldResponseType response = <span class=\"keyword\">new</span> HelloWorldResponseType();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> response;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"å®šä¹‰ä¸€ä¸ª-abstractprocessor-çš„å­ç±»\">å®šä¹‰ä¸€ä¸ª AbstractProcessor çš„å­ç±»<a title=\"#å®šä¹‰ä¸€ä¸ª-abstractprocessor-çš„å­ç±»\" href=\"#å®šä¹‰ä¸€ä¸ª-abstractprocessor-çš„å­ç±»\"></a></h2>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">WebServiceGenerateProcessor</span> <span class=\"keyword\">extends</span> <span class=\"title\">AbstractProcessor</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Map&lt;String, Pair&lt;TypeSpec.Builder, TypeSpec.Builder&gt;&gt; files = Maps.newLinkedHashMap();</span><br><span class=\"line\">    <span class=\"keyword\">private</span> JavacElements elementUtils;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> JavacTypes typeUtils;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Messager messager;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Set&lt;String&gt; <span class=\"title\">getSupportedAnnotationTypes</span><span class=\"params\">()</span> </span>&#123; <span class=\"keyword\">return</span> Collections.singleton(WebService.class.getName()); &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> SourceVersion <span class=\"title\">getSupportedSourceVersion</span><span class=\"params\">()</span> </span>&#123; <span class=\"keyword\">return</span> SourceVersion.RELEASE_8; &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">synchronized</span> <span class=\"keyword\">void</span> <span class=\"title\">init</span><span class=\"params\">(ProcessingEnvironment processingEnv)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.init(processingEnv);</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.elementUtils = (JavacElements) processingEnv.getElementUtils();</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.typeUtils = (JavacTypes) processingEnv.getTypeUtils();</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.messager = processingEnv.getMessager();</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.messager.printMessage(Diagnostic.Kind.NOTE, <span class=\"string\">&quot;Generate WebServices...&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">process</span><span class=\"params\">(Set&lt;? extends TypeElement&gt; annotations, RoundEnvironment roundEnv)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (roundEnv.processingOver()) &#123;</span><br><span class=\"line\">            <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">             * å†™æ–‡ä»¶</span></span><br><span class=\"line\"><span class=\"comment\">             * JavaFile.builder</span></span><br><span class=\"line\"><span class=\"comment\">             */</span></span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">             * ç”Ÿæˆæ–‡ä»¶å†…å®¹</span></span><br><span class=\"line\"><span class=\"comment\">             * é€šè¿‡ roundEnv.getElementsAnnotatedWith è·å– service class</span></span><br><span class=\"line\"><span class=\"comment\">             * é€šè¿‡ TypeSpec.interfaceBuilder TypeSpec.classBuilder</span></span><br><span class=\"line\"><span class=\"comment\">             * MethodSpec.methodBuilder CodeBlock.builder AnnotationSpec.builder</span></span><br><span class=\"line\"><span class=\"comment\">             * ç­‰æ–¹æ³•ç”Ÿæˆæ–‡ä»¶å†…å®¹</span></span><br><span class=\"line\"><span class=\"comment\">             */</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h1 id=\"æ•ˆæœ\">æ•ˆæœ<a title=\"#æ•ˆæœ\" href=\"#æ•ˆæœ\"></a></h1>\n<p>ç¼–è¯‘å™¨ä¼šåœ¨ç¼–è¯‘æœŸæ‰¾åˆ°æ‰€æœ‰æ·»åŠ äº† WebService æ³¨è§£çš„ç±»ï¼Œå¹¶æ ¹æ®æˆ‘ä»¬å®šä¹‰çš„ WebServiceGenerateProcessor.process é€»è¾‘ç”Ÿæˆ TestSOAService å’Œ TestSOAServiceImpl æ–‡ä»¶ã€‚</p>\n<p>è¿™æ ·æ¯å¤©åˆå¯ä»¥å¤šå‡º 5 åˆ†é’Ÿçš„æ‘¸é±¼æ—¶é—´ ğŸ¶ ã€‚</p>\n","prev":{"title":"ä¸€äº›æœ‰è¶£çš„ Codewars JavaScript é¢˜è§£","link":"2020/03/28/ä¸€äº›æœ‰è¶£çš„-Codewars-JavaScript-é¢˜è§£"},"next":{"title":"How to debug rust","link":"2019/11/04/How-to-debug-rust"},"plink":"https://syaki.github.io/2020/02/01/åˆ©ç”¨-AbstractProcessor-å¢åŠ æ‘¸é±¼æ—¶é—´/","toc":[{"id":"èƒŒæ™¯","title":"èƒŒæ™¯","index":"1"},{"id":"è§£å†³åŠæ³•","title":"è§£å†³åŠæ³•","index":"2","children":[{"id":"è‡ªå®šä¹‰-annotation","title":"è‡ªå®šä¹‰ Annotation","index":"2.1"},{"id":"å®šä¹‰ä¸€ä¸ª-abstractprocessor-çš„å­ç±»","title":"å®šä¹‰ä¸€ä¸ª AbstractProcessor çš„å­ç±»","index":"2.2"}]},{"id":"æ•ˆæœ","title":"æ•ˆæœ","index":"3"}],"copyright":{"author":"Syaki","link":"<a href=\"https://syaki.github.io/2020/02/01/åˆ©ç”¨-AbstractProcessor-å¢åŠ æ‘¸é±¼æ—¶é—´/\" title=\"åˆ©ç”¨ AbstractProcessor å¢åŠ æ‘¸é±¼æ—¶é—´\">https://syaki.github.io/2020/02/01/åˆ©ç”¨-AbstractProcessor-å¢åŠ æ‘¸é±¼æ—¶é—´/</a>","license":"Attribution-NonCommercial-NoDerivatives 4.0 International (<a href=\\\"https://creativecommons.org/licenses/by-nc-sa/4.0/\\\" rel=\\\"external nofollow\\\" target=\\\"_blank\\\">CC BY-NC-ND 4.0</a>)"}}